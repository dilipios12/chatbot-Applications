<!DOCTYPE html>
<html>

<head>
  <title>Chat Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- Bootstrap 4 CDN -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Then Bootstrap JS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script
    src='//static.codepen.io/assets/common/stopExecutionOnTimeout-b2a7b3fe212eaa732349046d8416e00a9dec26eb7fd347590fbced3ab38af52e.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">






  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">



  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    #imageEditorModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #editorBox {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      max-width: 90%;
      max-height: 90%;
      text-align: center;
    }

    #previewImage {
      max-width: 100%;
      max-height: 60vh;
    }

    button {
      margin: 5px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #cropBtn {
      background: green;
      color: white;
      padding: 10px;
    }

    #closeEditor {
      background: red;
      color: white;
      padding: 10px;
    }

    .chatHistoryContent {
      position: absolute;
    }

    .sidebar {
      width: 250px;
      height: 100vh;
      padding-top: 20px;
      position: fixed;
      left: 0;
      top: 0;
      background-color: #242020;
      color: #f3efef;
      border-radius: 5px;
      border: 1px solid #D9DBE4;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }

    th,
    td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }

    button {
      margin-right: 5px;
      cursor: pointer;
    }

    .sidebar a {
      display: block;
      padding: 8px 20px;
      color: #faeeee;
      text-decoration: none;
      font-family: none;
      font-size: 18px;
    }

    .sidebar a:hover {
      background: #007bff;
      color: white;
    }

    .main-content {
      margin-left: 270px;
      margin-right: 25px;
      padding: 20px;
      background-color: #fff;
      color: #545454;
      border-radius: 5px;
    }

    .form-label {
      font-weight: bold;
    }


    .avatar-upload {
      position: relative;
      max-width: 205px;
      margin: 50px auto;
    }

    .avatar-upload .avatar-edit {
      position: absolute;
      right: 12px;
      z-index: 1;
      top: 10px;
    }

    .avatar-upload .avatar-edit input {
      display: none;
    }

    .avatar-upload .avatar-edit input+label {
      display: inline-block;
      width: 34px;
      height: 34px;
      margin-bottom: 0;
      border-radius: 100%;
      background: #FFFFFF;
      border: 1px solid transparent;
      box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.12);
      cursor: pointer;
      font-weight: normal;
      transition: all 0.2s ease-in-out;
    }

    .avatar-upload .avatar-edit input+label:hover {
      background: #f1f1f1;
      border-color: #d6d6d6;
    }

    .avatar-upload .avatar-edit input+label:after {
      content: "\f040";
      font-family: 'FontAwesome';
      color: #757575;
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      text-align: center;
      margin: auto;
    }

    .avatar-upload .avatar-preview {
      width: 192px;
      height: 192px;
      position: relative;
      border-radius: 100%;
      border: 6px solid #F8F8F8;
      box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
    }

    .avatar-upload .avatar-preview>div {
      width: 100%;
      height: 100%;
      border-radius: 100%;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }

    .container2 .btn {
      position: absolute;
      top: 90%;
      left: 50%;
      transform: translate(-50%, -50%);
      -ms-transform: translate(-50%, -50%);
      color: white;
      font-size: 16px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      text-align: center;
    }

    .script-container {
      position: relative;
      display: inline-block;
    }

    /* Default appearance */
    .scriptcopy {
      background-color: #fff;
      /* default background */
      transition: background-color 0.3s ease;
    }

    /* Change background on hover */
    .scriptcopy:hover {
      background-color: rgba(3, 120, 245, 0.5);
      /* light RGBA background */
      color: #007bff;
    }

    /* Hidden by default */
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(14, 119, 231, 0.85);
      z-index: 999;
      display: none;
      color: rgb(14, 14, 14);
      padding: 5px 12px;
      transform: translateY(100px);
      margin-right: 160px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid white;
    }

    /* Show button when hovering over container */
    .script-container:hover .copy-btn {
      display: block;
    }

    #chat-box {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
    }



    .user-msg {
      max-width: 70%;
      padding: 10px;
      border-radius: 15px;
      word-break: break-word;
      margin: 5px 0px;
      font-family: Arial, sans-serif;
      background-color: rgb(49, 54, 231);
      color: rgb(255, 255, 255);
      align-self: flex-start;
    }

    .admin-msg {
      max-width: 70%;
      padding: 10px;
      border-radius: 15px;
      word-break: break-word;
      margin: 5px 0px;
      font-family: Arial, sans-serif;
      background-color: rgb(210, 236, 245);
      color: rgb(0, 0, 0);
      align-self: flex-end;
    }

    .msg span {
      font-size: 14px;
    }

    .msg small {
      font-size: 10px;
      align-self: flex-end;
      color: #666;
      margin-top: 4px;
    }


    #chatIdBox {
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      padding: 10px;
      max-height: 300px;
      box-shadow: 0px 0px 5px 1px #40b0ea;
      border: 1px solid #e9bc332e;
    }

    .chat-wrapper {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      background: #f9f9f9;
      box-shadow: 0px 0px 1px 1px aliceblue;
    }

    .chat-box {
      height: 300px;
      width: 100%;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
    }

    .input-row {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex-grow: 1;
    }

    .chat-send-btn {
      white-space: nowrap;
    }

    /* WhatsApp-style chat bubbles */
    .msg {
      display: flex;
      flex-direction: column;
      max-width: 75%;
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 12px;
      word-wrap: break-word;
    }



    .msg span {
      font-size: 14px;
    }

    .msg small {
      font-size: 10px;
      align-self: flex-end;
      color: #666;
      margin-top: 4px;
    }

    .allchat {
      height: 40px;
      background-color: #0494db;
      color: white;
      border-radius: 20px;
      width: 50%;
      margin: 0px auto;
      text-align: center;
      line-height: 0px;
    }

    .text-blue {
      color: blue;
    }

    .text-red {
      color: red;
    }

    .sidebar-link.active {
      background: #007bff;
      color: hsl(0, 0%, 94%);
      font-weight: bold;
    }

    div#updateModal {
      display: none;
      z-index: 1000;
      padding-top: 60px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: auto;
      padding: 20px;
      border-radius: 8px;
      width: 400px;
    }








    .modal {
      position: fixed;
      inset: 0;
      display: none;
    }

    .modal[aria-hidden="false"] {
      display: block;
    }

    .modal__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, .4);
    }

    .modal__dialog {
      position: relative;
      margin: 10vh auto 0;
      max-width: 420px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
      padding: 20px;
      animation: pop .15s ease-out;
    }

    .modal__title {
      margin: 0 0 8px;
      font-size: 18px;
    }

    .modal__text {
      margin: 0 0 16px;
      color: #444;
    }

    .modal__actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn {
      padding: 10px 14px;
      border: 0;
      border-radius: 10px;
      cursor: pointer;
    }

    .btn:hover {
      filter: brightness(0.97);
    }

    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .btn.btn--ghost {
      background: #f2f2f2;
    }

    .btn:not(.btn--ghost) {
      background: #0a6fbd;
      color: #fff;
    }

    .modal__error {
      margin-top: 10px;
      color: #b00020;
      font-size: 14px;
    }

    @keyframes pop {
      from {
        transform: translateY(10px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }


    @media (min-width: 768px) {
      .filter-label-inline {
        display: inline-block;
        margin-right: 8px;
      }
    }

    @media (max-width: 767px) {
      .filter-label-inline {
        display: block;
        margin-bottom: 4px;
      }
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <img src="https://iosandweb.com/static/media/IAW-logo-white.6b112d39bfa39ab63a4a.png" alt="img"
      style="height:60px;margin: 0px auto;">
    <hr class="mt-2" style="border: 1px solid white;">

    <a href="#" class="sidebar-link" onclick="showSection('overview', this)">Overview</a>
    <a href="#chat_settings" class="sidebar-link" onclick="showSection('settings', this)">Chat Settings</a>
    <a href="#live_chat" class="sidebar-link" onclick="showSection('livechat', this)">Live chat</a>
    <a href="#chat_history" class="sidebar-link" onclick="showSection('history', this)">Chat History</a>
    <a href="#email_notifications" class="sidebar-link" onclick="showSection('Emailnotifications', this)">Email
      Notifications</a>
    <a href="#faq_management" class="sidebar-link" onclick="showSection('faqmanagement', this)">FAQ Management</a>
    <a href="#manage_faq_sources_pdf" class="sidebar-link" onclick="showSection('managefaqsources', this)">Manage FAQ
      Sources</a>


    <a href="#trackscript" class="sidebar-link super-admin-only" onclick="showSection('trackscripts', this)">User
      Credential</a>

    <button class="" id="logout-btn"
      style="background-color: #007bff;border-radius: 5px; color:white;padding: 10px 12px;text-align:center; margin: 18px 22px;">Logout</button>
  </div>

  <div class="main-content">
    <div id="trackscripts" class="section" style="flex: 1;;display: block;">
      <h2 style="font-size: 25px;">Admin Details</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <div class="row">
        <div class="col-sm-12" style="margin-top: 40px;">
          <!-- Filters -->
          <div class="row mb-3">
            <!-- Role Filter -->
            <div class="col-md-4 col-12 mb-2">
              <label for="roleFilter" class="mr-2 d-block">
                <i class="fa-solid fa-user-shield"></i> Role:
              </label>
              <select id="roleFilter" onchange="filterUsers()" class="form-control">
                <option value="">All</option>
                <option value="Super Admin">Super Admin</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <!-- Username Search -->
            <div class="col-md-4 col-12 mb-2">
              <label for="searchInput" class="mr-2 d-block">
                <i class="fa-solid fa-magnifying-glass"></i> Username:
              </label>
              <input type="text" id="searchInput" oninput="filterUsers()" class="form-control"
                placeholder="Enter username..." />
            </div>

            <!-- Status Filter -->
            <div class="col-md-4 col-12 mb-2">
              <label for="activeuser" class="mr-2 d-block">
                <i class="fa-solid fa-toggle-on"></i> Status:
              </label>
              <select id="activeuser" onchange="filterUsers()" class="form-control">
                <option value="">All</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>


          <!-- Table -->
          <div class="table-responsive shadow-sm">
            <table id="userTable" class="table table-striped table-bordered table-hover">
              <thead class="thead-light">
                <tr style="white-space: nowrap;">
                  <th><i class="fa-solid fa-id-badge"></i> User</th>
                  <th><i class="fa-solid fa-user"></i> Username</th>
                  <th><i class="fa-solid fa-envelope"></i> Email</th>
                  <th><i class="fa-solid fa-users-gear"></i> Role</th>
                  <th><i class="fa-solid fa-key"></i> Password</th>
                  <th><i class="fa-solid fa-circle-info"></i> Status</th>
                  <th><i class="fa-solid fa-calendar-days"></i> Created At</th>
                  <th><i class="fa-solid fa-gear"></i> Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Edit Modal -->
          <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content shadow-lg rounded">
                <div class="modal-header bg-primary text-white">
                  <h5 class="modal-title"><i class="fa-solid fa-user-pen"></i> Edit User</h5>
                  <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>

                <div class="modal-body">
                  <input type="hidden" id="editUserId">

                  <div class="form-group">
                    <label><i class="fa-solid fa-user"></i> Username</label>
                    <input type="text" id="editUsername" class="form-control">
                  </div>

                  <div class="form-group">
                    <label><i class="fa-solid fa-envelope"></i> Email</label>
                    <input type="email" id="editEmail" class="form-control">
                  </div>

                  <div class="form-group">
                    <label><i class="fa-solid fa-key"></i> Password</label>
                    <input type="text" id="editPassword" class="form-control">
                  </div>

                  <div class="form-group">
                    <label><i class="fa-solid fa-toggle-on"></i> Status</label>
                    <select id="editStatus" class="form-control">
                      <option value="active">Active</option>
                      <option value="inactive">Inactive</option>
                    </select>
                  </div>
                </div>

                <div class="modal-footer">
                  <button onclick="updateUser()" class="btn btn-success">
                    <i class="fa-solid fa-floppy-disk"></i> Update
                  </button>
                  <button class="btn btn-secondary" data-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i> Close
                  </button>
                </div>
              </div>
            </div>
          </div>

          <br>
          <hr />
        </div>
      </div>

    </div>
    <div id="overview" class="section" style="display:block;">
      <div class="row">
        <div class="col-sm-5"></div>
        <div class="col-sm-5"></div>
      </div>
      <h2 style="font-size: 25px; font-family: none; font-weight: 200;">Overview</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <div class="row mt-4">
        <div class="col-sm-6">
          <label><i class=" fa-solid bi bi-pencil-square"></i>
            Property Name</label>
          <input type="text" id="chatHeader" class="form-control mb-2">
          <div class="row">
            <div class="col-sm-12"> <label class="form-label"><i class="bi bi-paint-bucket"></i>
                Chat Header Color:</label><br>
              <div style="border: 1px solid rgb(189, 189, 182); padding: 5px; border-radius: 5px;">
                <input type="color" id="overviewColor" class="mb-2"
                  style="height: 40px; width: 20%; border: 1px solid rgb(196, 196, 188); padding: 5px; margin-right: 10px;" />
                &nbsp; &nbsp; <span id="colorCode" style="font-weight: bold;">#1964114
                </span>
                </span>
              </div>
            </div>
          </div>
          <label class="form-label">
            <i class="fa-solid fa-text-height"></i> &nbsp; Font Size:</label>
          <select id="fontSize" class="form-select mb-2">
            <!-- Relative Sizes -->
            <option value="xx-small" style="font-size: xx-small;">XX-Small</option>
            <option value="x-small" style="font-size: x-small;">X-Small</option>
            <option value="small" style="font-size: small;">Small</option>
            <option value="smaller" style="font-size: smaller;">Smaller</option>
            <option value="medium" style="font-size: medium;">Medium (Default)</option>
            <option value="larger" style="font-size: larger;">Larger</option>
            <option value="large" style="font-size: large;">Large</option>
            <option value="x-large" style="font-size: x-large;">X-Large</option>
            <option value="xx-large" style="font-size: xx-large;">XX-Large</option>

            <!-- Pixel Sizes -->
            <option value="8px" style="font-size: 8px;">8px</option>
            <option value="10px" style="font-size: 10px;">10px</option>
            <option value="12px" style="font-size: 12px;">12px</option>
            <option value="14px" style="font-size: 14px;">14px</option>
            <option value="16px" style="font-size: 16px;">16px</option>
            <option value="18px" style="font-size: 18px;">18px</option>
            <option value="20px" style="font-size: 20px;">20px</option>
            <option value="24px" style="font-size: 24px;">24px</option>
            <option value="28px" style="font-size: 28px;">28px</option>
            <option value="32px" style="font-size: 32px;">32px</option>
          </select>
          <div class="row">
            <div class="col-sm-12">

              <label class="form-label"> <i class="fa-solid fa-trowel-bricks"></i> &nbsp; Chat icons :</label>
              <div style="border: 1px solid rgb(189, 189, 182); padding: 5px; border-radius: 5px;">
                <input type="color" id="color" class="mb-2"
                  style="height: 40px; width: 20%; border: 1px solid rgb(196, 196, 188); padding: 5px; margin-right: 10px;" />
                &nbsp; &nbsp; <span id="colorCodecolor" style="font-weight: bold;">#1964114</span>
                </span>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-sm-12">
              <label class="form-label">Show Chat:</label>
              <input type="checkbox" id="show"><br><br>
            </div>
          </div>

          <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>


        <div class="col-sm-6">
          <label class="form-label">Welcome Message</label>
          <textarea type="text" id="welcome" placeholder="welcome Massages" class="form-control mb-2">
          </textarea>
          <label class="form-label">
            <i class="fa-solid fa-photo-film"></i> Property Image:
          </label>
          <input type="file" id="propertyImage" accept="image/*" class="form-control mb-3">
          <div id="checkboxContainer" style="display:none;">
            <label>Show Chat Icon :</label> &nbsp; &nbsp; &nbsp;
            <input type="checkbox" id="showImage" class="form-check-input mb-3" checked>
          </div>

          <label class="form-label">Property URL:</label>
          <input type="text" id="Propertyurl" class="form-control mb-3" readonly>


          <label class="form-label">Widget Id </label>
          <input type="text" id="widgetId" class="form-control mb-2" readonly>
          <!-- âœ… Modal for Cropper -->
          <div id="imageEditorModal">
            <div id="editorBox">
              <img id="previewImage" src="" alt="Preview">
              <div class="mt-2">
                <button id="cropBtn">Save</button>
                <button id="closeEditor">Close</button>
              </div>
            </div>
          </div>
        </div>





      </div>
    </div>




    <div id="settings" class="section" style="display:block;">
      <h2 style="font-size: 25px;">Chat Widget Settings</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <div class="container-fluid mt-3">
        <div class="row">
          <!-- Settings Form -->
          <div class="col-12 col-md-6 mb-4">
            <label class="form-label"> <i class="fa-solid fa-door-open"></i> &nbsp; Welcome Message:</label>
            <input type="text" id="welcome" placeholder="Welcome message" class="form-control mb-2" />

            <label class="form-label">
              <i class="fa-solid fa-up-down-left-right"></i> &nbsp; Widget Position:</label>
            <select id="position" class="form-select mb-2">
              <option value="bottom-right">Bottom Right</option>
              <option value="bottom-left">Bottom Left</option>
              <option value="top-right">Top Right</option>
              <option value="top-left">Top Left</option>
            </select>

            <label for="fontFamily" class="form-label">
              <i class="fa-solid fa-font-awesome"></i> &nbsp; Font Family:</label>
            <select id="fontFamily" class="form-select mb-2" placeholder="Arial">
              <option value="Arial" style="font-family: Arial;">Arial</option>
              <option value="Verdana" style="font-family: Verdana;">Verdana</option>
              <option value="Helvetica" style="font-family: Helvetica;">Helvetica</option>
              <option value="Tahoma" style="font-family: Tahoma;">Tahoma</option>
              <option value="Trebuchet MS" style="font-family: 'Trebuchet MS';">Trebuchet MS</option>
              <option value="Times New Roman" style="font-family: 'Times New Roman';">Times New Roman</option>
              <option value="Georgia" style="font-family: Georgia;">Georgia</option>
              <option value="Garamond" style="font-family: Garamond;">Garamond</option>
              <option value="Courier New" style="font-family: 'Courier New';">Courier New</option>
              <option value="Lucida Console" style="font-family: 'Lucida Console';">Lucida Console</option>
              <option value="Impact" style="font-family: Impact;">Impact</option>
              <option value="Palatino" style="font-family: Palatino;">Palatino</option>
              <option value="Segoe UI" style="font-family: 'Segoe UI';">Segoe UI</option>
              <option value="Comic Sans MS" style="font-family: 'Comic Sans MS';">Comic Sans MS</option>
              <option value="Century Gothic" style="font-family: 'Century Gothic';">Century Gothic</option>
              <option value="Candara" style="font-family: Candara;">Candara</option>
              <option value="Calibri" style="font-family: Calibri;">Calibri</option>
              <option value="Optima" style="font-family: Optima;">Optima</option>
              <option value="fantasy" style="font-family:fantasy ;">Fantasy</option>
              <option value="system-ui" style="font-family:system-ui;">System Ui</option>
              <option value="ui-serif" style="font-family:ui-serif;">Ui-Serif</option>
              <option value="ui-sans-serif" style="font-family:ui-sans-serif ;">Ui-Sans-Serif</option>
              <option value="Franklin Gothic Medium" style="font-family: 'Franklin Gothic Medium';">Franklin Gothic
                Medium</option>
              <option value="Futura" style="font-family: Futura;">Futura</option>
              <option value="Rockwell" style="font-family: Rockwell;">Rockwell</option>
              <option value="Baskerville" style="font-family: Baskerville;">Baskerville</option>
              <option value="Didot" style="font-family: Didot;">Didot</option>
              <option value="Book Antiqua" style="font-family: 'Book Antiqua';">Book Antiqua</option>
              <option value="Century Schoolbook" style="font-family: 'Century Schoolbook';">Century Schoolbook</option>
              <option value="Monaco" style="font-family: Monaco;">Monaco</option>
              <option value="Consolas" style="font-family: Consolas;">Consolas</option>
              <option value="Lucida Sans" style="font-family: 'Lucida Sans';">Lucida Sans</option>
              <option value="Courier" style="font-family: Courier;">Courier</option>
              <option value="inherit" style="font-family:inherit">Inherit</option>
              <option value="Revert" style="font-family: revert;">Revert</option>
              <option value="Revert-layer" style="font-family: revert-layer;">revert-layer</option>
              <option value="Unset" style="font-family: unset">unset</option>
              <option value="Serif" style="font-family: serif;">Serif</option>
              <option value="Sans-serif" style="font-family: sans-serif;">Sans Serif</option>
              <option value="Monospace" style="font-family: monospace;">Monospace</option>
              <option value="Cursive" style="font-family: cursive;">Cursive</option>
              <option value="Ui-monospace" style="font-family:ui-monospace ;">Ui-Monospace</option>

            </select>
            <!-- <label class="form-label">Font Size:</label>            <input type="text" id="fontSize" placeholder="e.g. 14px" class="form-control mb-3" /> -->
            <!-- <input type="text" id="fontSizeOverview" placeholder="e.g. 14px" class="form-control mb-2"> -->

            <label for="fontSizeOverview" class="form-label">
              <i class="fa-solid fa-text-height"></i> &nbsp; Font Size:</label>
            <select id="fontSizeOverview" class="form-select mb-2">
              <!-- Relative Sizes -->
              <option value="xx-small" style="font-size: xx-small;">XX-Small</option>
              <option value="x-small" style="font-size: x-small;">X-Small</option>
              <option value="small" style="font-size: small;">Small</option>
              <option value="smaller" style="font-size: smaller;">Smaller</option>
              <option value="medium" style="font-size: medium;">Medium (Default)</option>
              <option value="larger" style="font-size: larger;">Larger</option>
              <option value="large" style="font-size: large;">Large</option>
              <option value="x-large" style="font-size: x-large;">X-Large</option>
              <option value="xx-large" style="font-size: xx-large;">XX-Large</option>

              <!-- Pixel Sizes -->
              <option value="8px" style="font-size: 8px;">8px</option>
              <option value="10px" style="font-size: 10px;">10px</option>
              <option value="12px" style="font-size: 12px;">12px</option>
              <option value="14px" style="font-size: 14px;">14px</option>
              <option value="16px" style="font-size: 16px;">16px</option>
              <option value="18px" style="font-size: 18px;">18px</option>
              <option value="20px" style="font-size: 20px;">20px</option>
              <option value="24px" style="font-size: 24px;">24px</option>
              <option value="28px" style="font-size: 28px;">28px</option>
              <option value="32px" style="font-size: 32px;">32px</option>
            </select>
            <button class="btn btn-primary btn-block" onclick="saveOverview()"> Save Overview</button>
          </div>

          <!-- Script Output -->
          <div class="col-12 col-md-6 script-container position-relative">
            <label class="form-label">
              <i class="bi bi-code-slash"></i> Widget Code
            </label>
            <div>
              <textarea readonly class="scriptcopy form-control mb-2" id="copyScript"
                style="height: 200px; font-size: 13px;"></textarea>
              <button class="copy-btn" onclick="copyCode()">ðŸ“‹ Copy Widget Code</button>
            </div>

          </div>
        </div>
      </div>

    </div>

    <div id="history" class="section" style="flex: 1; padding: 10px; display: block;">
      <h2 style="font-size: 25px;">All chat History</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <div class="row mt-4">
        <div class="col-sm-5">
          <h3>Chat IDs</h3>
          <div id="chatIdBox" class="mt-3"
            style="display: flex; flex-direction: column; gap: 10px; overflow-y: auto; max-height: 400px;">
          </div>
        </div>
        <div class="col-sm-1"></div>
        <div class="col-sm-6">
          <h3>Chat History</h3>
          <div id="chatHistoryContent" class="mt-3"
            style="display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background-color: #fff;">
          </div>
        </div>

      </div>


    </div>
    <div id="livechat" class="section" style="flex: 1; padding: 10px;display: block;">
      <h2 style="font-size: 25px;">Live chat History</h2>
      <br>
      <hr style="border: 1px solid black;" />

      <div class="row mt-4">
        <!-- LEFT: Active Users -->
        <div class="col-sm-5">
          <b class="mt-3">Request ID (Active Users)</b>
          <ul id="user-list"
            style="height: 100px; width: 340px; border: 1px solid bisque; overflow-y: auto; list-style: none; padding: 0; margin: 0;">
          </ul>
        </div>
        <div class="col-sm-1"></div>

        <!-- RIGHT: Chat Section -->
        <div class="col-sm-6">
          <b>Chat History</b>
          <div class="chat-wrapper">
            <div id="chat-box" class="chat-box"></div>
            <div class="input-row mt-2 d-flex">
              <input type="text" id="admin-msg" class="form-control chat-input me-2" placeholder="Type reply..." />
              <button onclick="sendReply()" class="btn btn-primary chat-send-btn">Send</button>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div id="Emailnotifications" class="section" style="flex: 1; padding:10px;display: block;">
      <h2 style="font-size: 25px;">Email Notifications</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <br>

      <div class="p-4 bg-white shadow-md rounded-lg w-96 m-auto mt-10">
        <h3 class="text-blue-600 font-bold mb-2 text-lg">Email Notifications</h3>
        <form id="email-form" class="flex flex-col space-y-2">
          <input id="adminEmail" type="email" placeholder="Enter admin email"
            class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 text-sm" />
          <button type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 focus:outline-none">
            Update Email
          </button>
        </form>
        <p id="email-status" class="text-sm text-gray-600 mt-2"></p>
      </div>
    </div>


    <div id="faqmanagement" class="section" style="flex: 1; padding:10px;display: block;">
      <h2 style="font-size: 25px;">Manage FAQs for AI Training</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <br>
      <div class="p-4 bg-gray-50 border rounded-lg w-96 m-auto">
        <h3 class="text-blue-600 font-bold mb-2 text-lg">Manage FAQs</h3>
        <form id="faq-form" class="flex flex-col space-y-2">
          <input id="faqQuestion" type="text" placeholder="Enter question" class="p-2 border rounded-lg text-sm" />
          <textarea id="faqAnswer" placeholder="Enter answer" class="p-2 border rounded-lg text-sm"></textarea>
          <input id="faqId" type="hidden" />
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Add/Update
            FAQ</button>
        </form>



        <p id="faq-status" class="text-sm text-gray-600 mt-2"></p>
      </div>
      <div id="">
      </div>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th scope="col">Id</th>
            <th scope="col">Questions</th>
            <th scope="col">Answer</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="faq-list">

        </tbody>
      </table>


    </div>

    <div id="managefaqsources" class="section" style="flex: 1; padding: 10px;display: block;">

      <h2 style="font-size: 25px;">Manage FAQ Sources for AI Training</h2>
      <br>
      <hr style="border: 1px solid black;" />
      <br>
      <div class="p-4 bg-gray-50 border rounded-lg w-96 m-auto">
        <h3 class="text-blue-600 font-bold mb-2 text-lg">Manage FAQ Sources for AI Training</h3>
        <form id="faq-upload-form" class="flex flex-col space-y-2">
          <input type="file" id="pdfFile" accept=".pdf" class="p-2 border rounded-lg text-sm" />
          <input type="text" id="faqUrl" placeholder="Enter URL for FAQ generation"
            class="p-2 border rounded-lg text-sm" />
          <button type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 focus:outline-none">Add FAQ
            Source</button>
        </form>
        <!-- <div id="source-list" class="mt-4 space-y-2 max-h-48 overflow-y-auto">
          <p class="text-sm text-gray-500">No FAQ sources uploaded yet.</p>
        </div>
        <p id="upload-status" class="text-sm text-gray-600 mt-2"></p> -->
        <div id="upload-status" style="margin-top:10px;color:green;"></div>

      </div>


      <div id="source-list-container">
        <table border="1" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th>ID</th>
              <th>Type</th>
              <th>File/URL</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="source-list"></tbody>
        </table>
      </div>
      <div id="updateModal" class="modal">
        <div class="modal-content">
          <h4 style="font-size: 20px; text-align: center;">Update Manage FAQ Sources</h4>
          <br />
          <hr style="border: 1px solid black;" />
          <br />
          <label class="form-label">PDF File</label>
          <input type="file" id="updatePdf" accept="application/pdf"><br><br>
          <label class="form-label">URl</label>
          <input type="text" id="updateUrl" placeholder="Enter new URL"
            style="height:40px;border: 1px solid black; border-radius: 5px;"><br><br>
          <button class="btn btn-primary m-2" id="updateSubmit">Save Changes</button>
          <button class="btn btn-danger m-2" id="closeModal">Cancel</button>
        </div>
      </div>
    </div>
  </div>






  <!-- Modal markup -->
  <div id="logout-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true"
    aria-labelledby="logout-title">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
      <h3 id="logout-title" class="modal__title">Logout Admin</h3>
      <p class="modal__text">Are you sure you want to log out?</p>

      <div class="modal__actions">
        <button id="cancel-logout" class="btn btn--ghost">Cancel</button>
        <button id="confirm-logout" class="btn">Logout</button>
      </div>

      <p id="logout-error" class="modal__error" hidden></p>
    </div>
  </div>

  <!-- Modal markup   Delete the Username -->

  <div id="delete-modal" class="modal" aria-hidden="true" role="dialog">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
      <h3 id="delete-title">Delete User</h3>
      <p class="modal__text">Are you sure you want to delete this user?</p>
      <div class="modal__actions">
        <button id="cancel-delete" class="btn btn--ghost">Cancel</button>
        <button id="confirm-delete" class="btn">Delete</button>
      </div>
      <p id="delete-error" class="modal__error" hidden></p>
    </div>




    <!-- Modal markup   FQA the Username -->

    <div id="delete-modal" class="modal" aria-hidden="true" role="dialog">
      <div class="modal__backdrop" data-close></div>
      <div class="modal__dialog" role="document">
        <h3 id="delete-title">Delete User</h3>
        <p class="modal__text">Are you sure you want to delete this user?</p>
        <div class="modal__actions">
          <button id="cancel-delete" class="btn btn--ghost">Cancel</button>
          <button id="confirm-delete" class="btn">Delete</button>
        </div>
        <p id="delete-error" class="modal__error" hidden></p>
      </div>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>


      <script>
        const imageInput = document.getElementById('propertyImage');
        const checkboxContainer = document.getElementById('checkboxContainer');
        const modals = document.getElementById('imageEditorModal');
        const previewImage = document.getElementById('previewImage');
        const closeEditor = document.getElementById('closeEditor');
        const cropBtn = document.getElementById('cropBtn');
        const maxSize = 50 * 1024 * 1024 // 5MB
        let cropper;

        // When image is selected
        imageInput.addEventListener('change', () => {
          const file = imageInput.files[0];
          if (file) {
            if (file.size > maxSize) {
              alert('Image size is too large! Please upload an image smaller than 5MB.');
              imageInput.value = '';
              checkboxContainer.style.display = 'none';
            } else {
              checkboxContainer.style.display = 'block';

              // Open editor modal
              const reader = new FileReader();
              reader.onload = (e) => {
                previewImage.src = e.target.result;
                modals.style.display = 'flex';

                if (cropper) cropper.destroy();
                cropper = new Cropper(previewImage, {
                  aspectRatio: 16 / 9,
                  viewMode: 1,
                  movable: true,
                  zoomable: true,
                  rotatable: true,
                  scalable: true
                });
              };
              reader.readAsDataURL(file);
            }
          } else {
            checkboxContainer.style.display = 'none';
          }
        });

        // Close modal
        closeEditor.addEventListener('click', () => {
          modals.style.display = 'none';
          if (cropper) cropper.destroy();
        });

        // Save cropped image
        cropBtn.addEventListener('click', () => {
          if (cropper) {
            const canvas = cropper.getCroppedCanvas({
              width: 800,
              height: 450
            });

            canvas.toBlob((blob) => {
              const newFile = new File([blob], "cropped_image.png", { type: "image/png" });

              // Replace input file with cropped file
              const dataTransfer = new DataTransfer();
              dataTransfer.items.add(newFile);
              imageInput.files = dataTransfer.files;

              alert("Image cropped and saved!");
              modals.style.display = 'none';
              cropper.destroy();
            });
          }
        });
        (function () {
          const openBtn = document.getElementById("logout-btn");
          const modal = document.getElementById("logout-modal");
          const cancelBtn = document.getElementById("cancel-logout");
          const confirmBtn = document.getElementById("confirm-logout");
          const errorEl = document.getElementById("logout-error");

          let lastFocused;

          function openModal() {
            lastFocused = document.activeElement;
            modal.setAttribute("aria-hidden", "false");
            confirmBtn.focus();
            document.addEventListener("keydown", onKeyDown);
          }

          function closeModal() {
            modal.setAttribute("aria-hidden", "true");
            errorEl.hidden = true;
            errorEl.textContent = "";
            confirmBtn.disabled = false;
            if (lastFocused) lastFocused.focus();
            document.removeEventListener("keydown", onKeyDown);
          }

          function onKeyDown(e) {
            if (e.key === "Escape") closeModal();
          }

          // Open modal on logout click
          openBtn.addEventListener("click", (e) => {
            e.preventDefault();
            openModal();
          });

          // Close on cancel or backdrop click
          cancelBtn.addEventListener("click", closeModal);
          modal.addEventListener("click", (e) => {
            if (e.target.hasAttribute("data-close")) closeModal();
          });

          // Confirm logout
          confirmBtn.addEventListener("click", async () => {
            confirmBtn.disabled = true;
            errorEl.hidden = true;
            try {
              const res = await fetch("/logout", { method: "POST" });
              if (!res.ok) throw new Error("Network response was not ok");
              // success
              window.location.href = "/admin";
            } catch (err) {
              console.error("Logout error:", err);
              errorEl.textContent = "Logout failed. Please try again.";
              errorEl.hidden = false;
              confirmBtn.disabled = false;
            }
          });
        })();


        const socket = io("http://localhost:3000/");
        async function loadSettings() {
          const widgetId = localStorage.getItem("widgetId"); // âœ… Get it from localStorage
          if (!widgetId) {
            console.error("No widgetId found in localStorage.");
            return;
          }
          const res = await fetch(`/api/settings?id=${widgetId}`);
          const data = await res.json();
          if (!res.ok) {
            console.error("Widget not found");
            return;
          }
          document.getElementById('welcome').value = data.welcome || '';
          document.getElementById('fontSize').value = data.fontSize || '';
          document.getElementById('fontFamily').value = data.fontFamily || '';
          document.getElementById('position').value = data.position || '';
          document.getElementById('color').value = data.color || '';
          document.getElementById('show').checked = data.show || false;
          // document.getElementById('propertyName').value = data.propertyName || '';
          // document.getElementById('propertyUrl').value = data.propertyUrl || '';
          // document.getElementById('propertyStatus').value = data.status || 'active';
          // document.getElementById('propertyEmail').value = data.forwardEmail || '';
          document.getElementById('chatHeader').value = data.chatHeader || '';
          document.getElementById('overviewColor').value = data.overviewColor || '';
          document.getElementById('showImage').checked = data.showImage || false;
          // let imageUrl = file ? await fileToBase64(file) : null;
        }
        async function saveSettings() {
          const widgetId = localStorage.getItem("widgetId"); // âœ… Get it from localStorage
          const file = document.getElementById('propertyImage').files[0];
          let imageUrl = file ? await fileToBase64(file) : null;
          const payload = {
            widgetId, // or make this dynamic per user/page
            welcome: document.getElementById('welcome').value,
            chatHeader: document.getElementById('chatHeader').value,
            fontSize: document.getElementById('fontSize').value,
            overviewColor: document.getElementById('overviewColor').value,
            fontFamily: document.getElementById('fontFamily').value,
            color: document.getElementById('color').value,
            show: document.getElementById('show').checked,
            imageUrl: imageUrl, // Include image if needed

          };
          await fetch('/api/update-settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          alert('Widget settings saved.');
        }




        async function saveOverview() {
          const widgetId = localStorage.getItem("widgetId"); // âœ… Get it from localStorage
          const welcome = document.getElementById('welcome').value.trim(); // No || data
          const chatHeader = document.getElementById('chatHeader').value.trim();
          const fontSizeOverview = document.getElementById('fontSizeOverview').value;
          const position = document.getElementById('position').value;
          const showImg = document.getElementById('showImage').checked;
          const file = document.getElementById('propertyImage').files[0];
          let imageUrl = file ? await fileToBase64(file) : null;
          const payload = { widgetId, welcome, chatHeader, fontSizeOverview, position, showImage };
          if (imageUrl) payload.imageUrl = imageUrl;
          await fetch('/api/update-overview', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          alert('Overview saved successfully');
        }
        function fileToBase64(file) {
          return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(file);
          });
        }
        function readURL(input) {
          if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
              $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
              $('#imagePreview').hide();
              $('#imagePreview').fadeIn(650);
            }
            reader.readAsDataURL(input.files[0]);
          }
        }

        // Step 1: Fetch all chat IDs
        http://www.greensoftsolutions.co.in/

        document.addEventListener('DOMContentLoaded', function () {
          const adminName = localStorage.getItem('loggedInUsername'); // saved at login

          if (!adminName) {
            alert("No admin logged in");
            return;
          }

          fetch(`/api/get-all-user-ids?adminName=${adminName}`)
            .then(res => res.json())
            .then(userIds => {
              const chatIdBox = document.getElementById('chatIdBox');
              chatIdBox.innerHTML = ''; // clear old data
              userIds.forEach(userId => {
                const p = document.createElement('p');
                p.textContent = userId;
                p.style.cursor = 'pointer';
                p.style.padding = '5px 5px';
                p.style.borderBottom = '1px solid #ddd';
                p.style.backgroundColor = "#d2ecf5";
                p.style.borderRadius = "10px";
                p.style.textAlign = "center";
                p.style.margin = "5px 5px";
                p.onclick = () => loadChat(userId);
                chatIdBox.appendChild(p);
              });
            });

          function loadChat(userId) {
            fetch(`/api/get-messages?adminName=${adminName}&userId=${userId}`)
              .then(res => res.json())
              .then(data => {
                const container = document.getElementById('chatHistoryContent');
                if (!container) return;
                container.innerHTML = '';

                data.messages.forEach(msg => {
                  const bubble = document.createElement('div');
                  bubble.textContent = msg.message;
                  bubble.style.maxWidth = '70%';
                  bubble.style.padding = '10px';
                  bubble.style.borderRadius = '15px';
                  bubble.style.wordBreak = 'break-word';
                  bubble.style.margin = '5px 0';
                  bubble.style.fontFamily = 'Arial, sans-serif';

                  if (msg.sender === 'user') {
                    bubble.style.backgroundColor = '#3136e7';
                    bubble.style.color = '#fff';
                    bubble.style.alignSelf = 'flex-end';
                  } else {
                    bubble.style.backgroundColor = '#d2ecf5';
                    bubble.style.color = '#000';
                    bubble.style.alignSelf = 'flex-start';
                  }

                  container.appendChild(bubble);
                });
              });
          }
        });

        let selectedUserId = "";
        // 1. Load active users
        function loadUsers() {
          fetch('/api/active-users')
            .then(res => res.json())
            .then(users => {
              const list = document.getElementById('user-list');
              list.innerHTML = '';

              if (users.length === 0) {
                list.innerHTML = '<li style="color:gray;text-align:center;">No active users</li>';
                return;
              }

              users.forEach(userId => {
                const li = document.createElement('li');
                li.innerText = userId;
                li.style.cursor = 'pointer';
                li.style.padding = '5px';
                li.style.borderBottom = '1px solid #ddd';
                li.style.backgroundColor = "#d2ecf5";
                li.style.borderRadius = "10px";
                li.style.textAlign = "center";
                li.style.margin = "5px";
                li.onclick = () => loadChat(userId);
                list.appendChild(li);
              });
            });
        }

        // 2. Load chat history with selected user
      function loadChat(userId) {
  selectedUserId = userId;
  const chatBox = document.getElementById('chat-box');
  chatBox.innerHTML = '<p style="color:gray;">Loading chat...</p>';

  fetch(`/api/chat-history/${userId}`)
    .then(res => res.json())
    .then(data => {
      chatBox.innerHTML = '';
      data.forEach(({ sender, message, timestamp }) => {
        const div = document.createElement('div');
        div.className = sender === 'user' ? 'msg user-msg' : 'msg admin-msg';
        div.innerHTML = `<span>${message}</span><small>${timestamp}</small>`;
        chatBox.appendChild(div);
      });

      chatBox.scrollTop = chatBox.scrollHeight;
    });
}

        // 3. Send reply
        function sendReply() {
          const message = document.getElementById('admin-msg').value.trim();
          if (!message || !selectedUserId) return;

          socket.emit('admin-reply', { userId: selectedUserId, message, admin: adminName });
          const chatBox = document.getElementById('chat-box');
          const div = document.createElement('div');
          const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

          div.className = 'msg admin-msg';
          div.innerHTML = `<span>${message}</span><small>${timestamp}</small>`;
          chatBox.appendChild(div);

          document.getElementById('admin-msg').value = '';
          chatBox.scrollTop = chatBox.scrollHeight;
        }
        // 4. Real-time incoming messages
        socket.on('new-message', ({ userId, message, timestamp }) => {
          if (userId === selectedUserId) {
            const div = document.createElement('div');
            div.className = 'msg user-msg';
            div.innerHTML = `<span>${message}</span><small>${new Date(timestamp).toLocaleTimeString()}</small>`;
            document.getElementById('chat-box').appendChild(div);
          }
        });
        setInterval(loadUsers, 5000);
        loadUsers();
        async function showEmail() {
          try {
            const res = await fetch('http://localhost:3000/api/admin-email');
            const data = await res.json();
            console.log('data', data);
            document.getElementById('adminEmail').value = data.email || ''; // âœ… set value
            console.log('Loaded email:', data.email);
          } catch (err) {
            console.error('Failed to load email', err);
          }
        }

        // Call the function when the page loads
        document.addEventListener('DOMContentLoaded', showEmail);
        document.getElementById('email-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const adminEmail = document.getElementById('adminEmail').value;
          const status = document.getElementById('email-status');

          try {
            const res = await fetch('http://localhost:3000/update-admin-email', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ adminEmail }),
            });

            const data = await res.json();
            status.textContent = data.message;
            status.className = data.status === 'success'
              ? 'text-green-600 mt-2 text-sm'
              : 'text-red-600 mt-2 text-sm';
          } catch (err) {
            console.error(err);
            status.textContent = 'Error updating email.';
            status.className = 'text-red-600 mt-2 text-sm';
          }
        });
        const faqForm = document.getElementById('faq-form');
        const faqList = document.getElementById('faq-list');
        const faqStatus = document.getElementById('faq-status');
        const faqId = document.getElementById('faqId');
        const faqQuestion = document.getElementById('faqQuestion');
        const faqAnswer = document.getElementById('faqAnswer');

        const adminName = localStorage.getItem('loggedInUsername'); // saved at login

        // Submit Form: Add or Update FAQ
        faqForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = {
            adminName,
            id: faqId.value.trim(),
            question: faqQuestion.value.trim(),
            answer: faqAnswer.value.trim()
          };

          try {
            const res = await fetch('http://localhost:3000/add-faq', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });

            const result = await res.json();
            faqStatus.textContent = result.message;
            faqForm.reset();
            loadFAQs();
          } catch (err) {
            console.error("Error submitting FAQ:", err);
            faqStatus.textContent = "Failed to add/update FAQ.";
          }
        });



        // Handle Delete/Edit Button
        faqList.addEventListener("click", async (e) => {
          const deleteBtn = e.target.closest(".delete-btn");
          const editBtn = e.target.closest(".edit-btn");

          // Delete FAQ
          if (deleteBtn) {
            const id = deleteBtn.dataset.id;
            if (confirm("Are you sure you want to delete this FAQ?")) {
              try {
                await fetch('http://localhost:3000/delete-faq', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ adminName, id }) // include adminName for security
                });
                loadFAQs();
              } catch (err) {
                console.error("Error deleting FAQ:", err);
              }
            }
          }

          // Edit FAQ
          if (editBtn) {
            faqId.value = editBtn.dataset.id;
            faqQuestion.value = editBtn.dataset.question;
            faqAnswer.value = editBtn.dataset.answer;
          }
        });









        // Load FAQs for this admin only
        async function loadFAQs() {
          try {
            const res = await fetch(`http://localhost:3000/api/faqs?adminName=${encodeURIComponent(adminName)}`);
            const faqs = await res.json();

            faqList.innerHTML = '';
            faqs.forEach(faq => {
              const row = document.createElement('tr');
              row.innerHTML = `
        <td>${faq.id.slice(0, 4)}********${faq.id.slice(-4)}</td>
        <td>${faq.question}</td>
        <td>${faq.answer}</td>
        <td>
          <button class="edit-btn" style="color: blue;" 
            data-id="${faq.id}" 
            data-question="${faq.question}" 
            data-answer="${faq.answer}">
            <i class="fa fa-pencil-square-o fs-4" aria-hidden="true"></i>
          </button>
          &nbsp;
          <button class="delete-btn" style="color: red;" data-id="${faq.id}">
            <i class="fa fa-trash fs-4" aria-hidden="true"></i>
          </button>
        </td>
      `;
              faqList.appendChild(row);
            });
          } catch (err) {
            console.error("Error loading FAQs:", err);
            faqList.innerHTML = '<tr><td colspan="4">Failed to load FAQs.</td></tr>';
          }
        }

        // Load FAQs when page loads
        loadFAQs();
        window.onload = loadSources;
        const form = document.getElementById('faq-upload-form');
        const status = document.getElementById('upload-status');
        const sourceList = document.getElementById('source-list');
        let currentUpdateId = null;
        const modal = document.getElementById('updateModal');
        const closeModalBtn = document.getElementById('closeModal');

        // Load sources
        function loadSources() {
          const adminName = localStorage.getItem('loggedInUsername');
          fetch('http://localhost:3000/api/faq-sources', {
            headers: {
              "x-username": adminName
            }
          })
            .then(res => res.json())
            .then(sources => {
              sourceList.innerHTML = '';

              sources.forEach(src => {
                let fileOrUrl = '';

                src.data.forEach(item => {
                  if (item.type === 'pdf') {
                    fileOrUrl += `ðŸ“„ <strong>PDF:</strong> ${item.value}<br/>`;
                  }
                  if (item.type === 'url') {
                    fileOrUrl += `ðŸ”— <strong>URL:</strong> <a href="${item.value}" target="_blank">${item.value}</a><br/>`;
                  }
                });

                // Create a single row for this source
                const tr = document.createElement('tr');
                tr.innerHTML = `
          <td>${src.id}</td>
          <td>${src.data.map(d => d.type).join(', ')}</td>
          <td>${fileOrUrl || 'â€”'}</td>
          <td>
            <button class="btn btn-dark" onclick="deleteSource('${src.id}')">Delete</button>
            <button class="btn btn-danger" onclick="openUpdateModal('${src.id}')">Edit</button>
          </td>
        `;
                sourceList.appendChild(tr);
              });
            });
        }

        // Delete
        function deleteSource(id) {
          const adminName = localStorage.getItem('loggedInUsername');
          if (confirm(`Are you sure you want to delete?`)) {
            fetch(`http://localhost:3000/api/delete/${id}`, {
              method: 'DELETE',
              headers: {
                "x-username": adminName // âœ… send username
              }
            })
              .then(res => res.json())
              .then(() => {
                alert("âœ… Deleted successfully");
                loadSources();
              });
          }
        }

        // Open modal for editing
        function openUpdateModal(id) {
          currentUpdateId = id;
          document.getElementById('updatePdf').value = "";
          document.getElementById('updateUrl').value = "";
          modal.style.display = "block";
        }

        // Close modal
        closeModalBtn.onclick = () => {
          modal.style.display = "none";
        };
        window.onclick = (e) => {
          if (e.target === modal) {
            modal.style.display = "none";
          }
        };

        // Submit update
        document.getElementById('updateSubmit').addEventListener('click', () => {
          const pdfFile = document.getElementById('updatePdf').files[0];
          const url = document.getElementById('updateUrl').value.trim();
          const adminName = localStorage.getItem('loggedInUsername');

          if (!pdfFile && !url) {
            alert("âš ï¸ Please provide a PDF or URL to update.");
            return;
          }

          const formData = new FormData();
          if (pdfFile) {
            formData.append('pdf', pdfFile);
          }
          if (url) {
            formData.append('url', url);
          }

          fetch(`http://localhost:3000/api/update/${currentUpdateId}`, {
            method: 'PUT',
            body: formData,
            headers: {
              "x-username": adminName // âœ… send username
            }
          })
            .then(res => res.json())
            .then(() => {
              alert("âœ… Updated successfully");
              modal.style.display = "none";
              loadSources();
            });
        });

        // Initial load
        loadSources();
        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const pdfFile = document.getElementById('pdfFile').files[0];
          const faqUrl = document.getElementById('faqUrl').value.trim();
          const status = document.getElementById('upload-status');
          const adminName = localStorage.getItem('loggedInUsername'); // saved at login

          if (!pdfFile && !faqUrl) {
            alert("âš ï¸ Please select a PDF or enter a URL.");
            return;
          }

          try {
            // âœ… If PDF is selected â†’ call PDF API
            if (pdfFile) {
              const formData = new FormData();
              formData.append('pdf', pdfFile);

              const res = await fetch('http://localhost:3000/api/upload-pdf', {
                method: 'POST',
                body: formData,
                headers: {
                  "x-username": adminName
                }
              });

              const data = await res.json();
              if (!res.ok) throw new Error(data.error || "PDF upload failed");
              status.textContent = `âœ… PDF uploaded successfully.`;
            }

            // âœ… If URL is entered â†’ call URL API
            if (faqUrl) {
              const res = await fetch('http://localhost:3000/api/add-url', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  "x-username": adminName
                },
                body: JSON.stringify({ url: faqUrl })
              });

              const data = await res.json();
              if (!res.ok) throw new Error(data.error || "URL upload failed");
              status.textContent += ` âœ… URL uploaded successfully.`;
            }

            // Clear inputs
            document.getElementById('pdfFile').value = '';
            document.getElementById('faqUrl').value = '';

            // Reload table
            loadSources();
          } catch (err) {
            console.error("âŒ Upload error:", err);
            alert(err.message || "Something went wrong.");
          }
        });




        //-----------------------header color coode --------------------------------
        const colorPicker = document.getElementById("overviewColor");
        const colorCode = document.getElementById("colorCode");
        // Initialize with default value
        colorCode.textContent = colorPicker.value;
        // Update color code when user picks a color
        colorPicker.addEventListener("input", function () {
          colorCode.textContent = colorPicker.value;
        });

        // -----------------------------------togal color code --------------------------------

        const colorPickers = document.getElementById("color");
        const colorCodess = document.getElementById("colorCodecolor");

        // Initialize with default color
        colorCodess.textContents = colorPickers.value;

        // Update color code on color change
        colorPickers.addEventListener("input", function () {
          colorCodess.textContents = colorPickers.value;
        });


        setInterval(loadUsers, 1000);
        $("#imageUpload").change(function () {
          readURL(this);
        });

window.addEventListener("DOMContentLoaded", () => {
  fetch("http://localhost:3000/api/my-widget")
    .then(res => {
      if (!res.ok) throw new Error("Not logged in or no widget");
      return res.json();
    })
    .then(widget => {
      const textarea = document.getElementById("copyScript");
      const widgetId = localStorage.getItem("widgetId");  // âœ… from admin dashboard
      const adminName = localStorage.getItem("loggedInUsername") || "defaultAdmin"; // âœ… inject safely

      const scriptCode = `
<script>
  (function() {
    const currentWidgetId = '${widgetId}';
    const adminName = '${adminName}';
    fetch('http://localhost:3000/api/settings?id=' + currentWidgetId)
      .then(res => res.json())
      .then(widget => {
        if (widget.status === 'active') {
          const script = document.createElement('script');
          script.type = 'text/javascript';
          script.async = true;
          script.src = (location.protocol === 'https:' ? 'https://' : 'http://') +
                       'localhost:3000/api/load-widget?id=' + currentWidgetId +
                       '&adminName=' + encodeURIComponent(adminName);
          document.body.appendChild(script);
        } else {
          console.log("Widget is inactive.");
        }
      })
      .catch(err => console.error("Widget load failed", err));
  })();

      `.trim();

      textarea.value = scriptCode;
    })
    .catch(err => {
      console.warn("Could not load user widget:", err.message);
    });
});


        function copyCode() {
          const textarea = document.getElementById("copyScript");
          textarea.select();
          textarea.setSelectionRange(0, 99999); // For mobile
          document.execCommand("copy");
          alert("Script copied to clipboard!");
        }

        window.addEventListener("DOMContentLoaded", () => {
          const username = localStorage.getItem("loggedInUsername");
          const propertyUrl = localStorage.getItem("property_url");
          const widgetId = localStorage.getItem("widgetId");

          const chatHeaderEl = document.getElementById("chatHeader");
          const propertyUrlEl = document.getElementById("Propertyurl");
          const widgetIdEl = document.getElementById("widgetId");

          if (username && chatHeaderEl) {
            chatHeaderEl.value = username;
          }

          if (propertyUrl && propertyUrlEl) {
            propertyUrlEl.value = propertyUrl;
          }

          if (widgetId && widgetIdEl) {
            widgetIdEl.value = widgetId;
          }
        });



        //-------------- SHOW THE DATE FORMET IN TABLE -------------------------------



        // Call fetchUsers on page load
        document.addEventListener("DOMContentLoaded", fetchUsers);
        //--------------------------NAVBAR SETTING DASBOARD CODE -----------------------------------
        window.onload = loadSettings;
        function showSection(sectionId, clickedLink = null) {
          // Hide all sections
          document.querySelectorAll(".section").forEach(section => {
            section.style.display = "none";
          });

          // Show the selected section
          const target = document.getElementById(sectionId);
          if (target) {
            target.style.display = "block";
          }

          // Manage sidebar active state
          if (clickedLink) {
            document.querySelectorAll(".sidebar-link").forEach(link => {
              link.classList.remove("active");
            });
            clickedLink.classList.add("active");
          }
        }
        document.addEventListener("DOMContentLoaded", () => {
          showSection("overview");
          const loggedInUser = localStorage.getItem("loggedInUsername");

          // Check if NOT Super Admin
          if (loggedInUser !== "admin") {
            // Hide links only meant for Super Admin
            document.querySelectorAll(".super-admin-only").forEach(link => {
              link.style.display = "none";
            });
          }
        });






        let allUsers = [];
        let displayedUsers = []; // âœ… keep track of filtered/current users

        // âœ… Format date
        function formatDate(dateStr) {
          if (!dateStr) return "-";
          const date = new Date(dateStr);
          if (isNaN(date)) return dateStr;
          return new Intl.DateTimeFormat("en-IN", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            hour12: true,
          }).format(date);
        }

        // âœ… Render Users Table
        function renderTable(users) {
          displayedUsers = users; // âœ… save filtered list
          const tbody = document.querySelector("#userTable tbody");
          tbody.innerHTML = "";

          users.forEach((user, index) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
        <td>${user.userId}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.role || "-"}</td>
        <td>${user.password}</td>
        <td>${user.status}</td>
        <td>${formatDate(user.createdAt)}</td>
        <td style="white-space:nowrap">
          <button class="btn btn-warning btn-sm" onclick="editUser(${index})">Edit</button>
          <button class="btn btn-danger btn-sm" onclick="openDeleteModal('${user.userId}','${user.username}')">Delete</button>
        </td>
      `;
            tbody.appendChild(tr);
          });
        }

        // âœ… Fetch Users
        function fetchUsers() {
          fetch("http://localhost:3000/api/all-users")
            .then((res) => res.json())
            .then((data) => {
              allUsers = data;
              renderTable(allUsers); // render full list initially
            })
            .catch((err) => console.error("Error loading users:", err));
        }

        // âœ… Edit User (open modal) â€” uses displayedUsers
        function editUser(index) {
          const user = displayedUsers[index];
          if (!user) {
            console.error("User not found at index", index);
            return;
          }

          document.getElementById("editUserId").value = user.userId;
          document.getElementById("editUsername").value = user.username;
          document.getElementById("editEmail").value = user.email;
          document.getElementById("editPassword").value = user.password;
          document.getElementById("editStatus").value = user.status;

          $("#editUserModal").modal("show");
        }

        // âœ… Update User
        function updateUser() {
          const userId = document.getElementById("editUserId").value;
          const username = document.getElementById("editUsername").value;
          const email = document.getElementById("editEmail").value;
          const password = document.getElementById("editPassword").value;
          const status = document.getElementById("editStatus").value;

          fetch(`http://localhost:3000/api/update/admin/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, email, password, status }),
          })
            .then((res) => res.json())
            .then((data) => {
              alert("User updated successfully");
              $("#editUserModal").modal("hide");
              fetchUsers(); // reload table
            })
            .catch((err) => {
              console.error("Update failed:", err);
              alert("Failed to update user");
            });
        }
        // âœ… Delete Us        // Global modal references
        const deleteModal = document.getElementById("delete-modal");
        const cancelDeleteBtn = document.getElementById("cancel-delete");
        const confirmDeleteBtn = document.getElementById("confirm-delete");
        const deleteErrorEl = document.getElementById("delete-error");

        let lastFocused;
        let currentUserId = null;

        // Open modal for a specific user
        function openDeleteModal(userId, username) {
          currentUserId = userId;
          lastFocused = document.activeElement;
          deleteModal.setAttribute("aria-hidden", "false");
          confirmDeleteBtn.focus();
          document.addEventListener("keydown", onKeyDown);
        }

        // Close modal
        function closeDeleteModal() {
          deleteModal.setAttribute("aria-hidden", "true");
          deleteErrorEl.hidden = true;
          deleteErrorEl.textContent = "";
          confirmDeleteBtn.disabled = false;
          if (lastFocused) lastFocused.focus();
          document.removeEventListener("keydown", onKeyDown);
        }

        // Handle ESC key
        function onKeyDown(e) {
          if (e.key === "Escape") closeDeleteModal();
        }

        // Cancel button
        cancelDeleteBtn.addEventListener("click", closeDeleteModal);
        // Backdrop click
        deleteModal.addEventListener("click", (e) => {
          if (e.target.hasAttribute("data-close")) closeDeleteModal();
        });

        // Confirm delete action
        confirmDeleteBtn.addEventListener("click", async () => {
          if (!currentUserId) return;

          confirmDeleteBtn.disabled = true;
          deleteErrorEl.hidden = true;

          try {
            const response = await fetch(
              `http://localhost:3000/api/delete-user/${currentUserId}`,
              { method: "DELETE", headers: { "Content-Type": "application/json" } }
            );

            if (response.ok) {
              closeDeleteModal();
              fetchUsers(); // refresh list
            } else {
              const data = await response.json();
              deleteErrorEl.textContent = "Error: " + data.message;
              deleteErrorEl.hidden = false;
              confirmDeleteBtn.disabled = false;
            }
          } catch (err) {
            console.error("Delete error:", err);
            deleteErrorEl.textContent = "Delete failed. Please try again.";
            deleteErrorEl.hidden = false;
            confirmDeleteBtn.disabled = false;
          }
        });


        // âœ… Filter Users
        function filterUsers() {
          const role = document.getElementById("roleFilter").value.toLowerCase();
          const search = document.getElementById("searchInput").value.toLowerCase();
          const adminstatus = document.getElementById("activeuser").value.toLowerCase();

          const filtered = allUsers.filter((user) => {
            const matchRole = role ? (user.role || "").toLowerCase() === role : true;
            const matchSearch = user.username.toLowerCase().includes(search);
            const matchStatus = adminstatus
              ? (user.status || "").toLowerCase() === adminstatus
              : true;
            return matchRole && matchSearch && matchStatus;
          });

          renderTable(filtered); // âœ… also updates displayedUsers
        }

        // âœ… Initial Load
        fetchUsers();
      </script>




      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <!-- Then Bootstrap JS -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>
